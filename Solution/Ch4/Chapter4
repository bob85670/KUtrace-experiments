This is difficult. I barely understand the given code.

4.1) matrix_remap_openmp.cc
I use openMP API because it is convenient. Or I may try to parallelize myself in future.